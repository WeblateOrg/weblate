#
# VirtualHost for Weblate
#
# This example assumes Weblate is installed in virtualenv in /home/weblate/weblate-env
# and DATA_DIR is set to /home/weblate/data, please adjust paths to match your setup.
# Replace <your_domain> with your domain

<VirtualHost *:80>
    ServerName <your_domain>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    RewriteEngine on
    RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin admin@<your_domain>
    ServerName <your_domain>

    # DATA_DIR/static/favicon.ico
    Alias /favicon.ico /home/weblate/lib/python3.9/site-packages/data/static/favicon.ico

    # DATA_DIR/static/
    Alias /static/ /home/weblate/lib/python3.9/site-packages/data/static/
    <Directory /home/weblate/lib/python3.9/site-packages/data/static/>
        Require all granted
    </Directory>

    # DATA_DIR/media/
    Alias /media/ /home/weblate/lib/python3.9/site-packages/data/media/
    <Directory /home/weblate/lib/python3.9/site-packages/data/media/>
        Require all granted
    </Directory>

    SSLEngine On
    SSLCertificateFile    /etc/letsencrypt/live/<your_domain>/cert.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/<your_domain>/privkey.pem
    SSLCertificateChainFile /etc/letsencrypt/live/<your_domain>/fullchain.pem

    # Path to your Weblate virtualenv
    WSGIDaemonProcess weblate python-home=/home/weblate/lib/python3.9 user=weblate request-timeout=600
    WSGIProcessGroup weblate
    WSGIApplicationGroup %{GLOBAL}

    WSGIScriptAlias / /home/weblate/lib/python3.9/site-packages/weblate/wsgi.py process-group=weblate
    WSGIPassAuthorization On

    <Directory /home/weblate/lib/python3.9/site-packages/weblate/>
        <Files wsgi.py>
        Require all granted
        </Files>
    </Directory>
</VirtualHost>
